"use strict";function updateGraph(e,t){function i(e){var t=d3.interpolate(this.textContent,e),i=(e+"").split("."),s=i.length>1?Math.pow(10,i[1].length):1;return function(e){this.textContent=Math.round(t(e)*s)/s}}function s(e){var t=d3.interpolate(this._current,e);return this._current=t(0),function(e){return d(t(e))}}if(void 0===e)var a=[100,0,0,100,0,0,100],r=d3.scale.ordinal().range(["#ccc"]),n=[0],o=["GB de uso mensual"];else{var a=e.list.gb,r=d3.scale.ordinal().range(colors);if(void 0===t)var n=e.messages.base.number,o=e.messages.base.string;else var n=e.messages[t[0]].number,o=e.messages[t[0]].string}var u=d3.layout.pie().sort(null),d=d3.svg.arc().startAngle(function(e){return e.startAngle}).endAngle(function(e){return e.endAngle}).innerRadius(innerRadius).outerRadius(radius),l=svg.selectAll("path").data(u(a)),h=subGroupA.selectAll("text").data(n),f=subGroupB.selectAll("text").data(o);l.attr("fill",function(e,t){return r(t)}).attr("opacity",function(e,i){return void 0!==t?t[1]===i?1:.5:1}),h.attr("y",function(e,i){return void 0===t?120+120*i:70+110*i}),f.attr("y",function(e,i){return void 0===t?150+120*i:100+110*i}),l.enter().append("path").attr("fill",function(e,t){return r(t)}).attr("d",d).each(function(e){this._current=e}),h.enter().append("svg:text").attr("fill",fontFill).attr("text-anchor","middle").attr("y",function(e,i){return void 0===t?120+120*i:80+120*i}).style("font-size",function(e,t){return fontSize+"px"}),f.enter().append("svg:text").attr("fill",fontFill).attr("text-anchor","middle").attr("y",function(e,i){return void 0===t?150+120*i:110+120*i}).style("font-size",function(e,t){return fontSize/5+"px"}),l.transition().duration(1e3).attrTween("d",s),h.transition().duration(500).tween("text",i),f.text(function(e){return e}),l.exit().remove(),f.exit().remove(),h.exit().remove()}var dataset={qOfUsers:[{basic:2,medium:6,high:12},{basic:2,medium:7,high:14},{basic:3,medium:8,high:16},{basic:3,medium:8,high:18},{basic:4,medium:9,high:20},{basic:4,medium:10,high:22},{basic:4,medium:11,high:24},{basic:5,medium:12,high:26},{basic:5,medium:12,high:28},{basic:6,medium:13,high:30}],maxValues:{basic:{q:[13107,5120,4864,1280,640,0,0],gb:[3,75,95,75,3,0,0]},medium:{q:[26214,2389,2176,853,1280,1138,640],gb:[5,35,43,50,5,100,13]},high:{q:[26214,1365,1024,469,1920,1707,1024],gb:[5,20,20,28,8,150,20]}},messages:{mail:"mails equivalen a",web:"horas en la web equivalen a",social:"horas en redes sociales equivalen a",music:"horas de streaming de mÃºsica equivalen a",chat:"horas de video llamadas equivalen a",video:"horas de streaming de video equivalen a",games:"horas de juegos online equivalen a"},conversion:[190735e-9,.01464844,47684e-8,.0585937,.00488281,.00390625,.87890625,.01953125]},familyData={createProfile:function(e){this.profile=e.profile},consumptionTotal:function(e,t){var i=e.basicUser||0,s=e.mediumUser||0,a=e.highUser||0,r=t[e.numOfDisp-1],n=250*(r.basic/100*i+r.medium/100*s+r.high/100*a);this.total=n>250?250:Math.floor(n)},consumptionList:function(e){for(var t=e[this.profile],i={q:[],gb:[]},s=0;s<t.q.length;s++)i.q.push(Math.floor(t.q[s]*(this.total/250))),i.gb.push(Math.round(t.gb[s]*(this.total/250)*10)/10);this.list=i},createMessages:function(e){var t=0,i={};i.base={number:[this.total],string:["GB de uso mensual"]};for(var s in e)i[s]={number:[this.list.q[t],this.list.gb[t]],string:[e[s],"GB de consumo"]},t++;this.messages=i},createData:function(e,t){this.createProfile(e),this.consumptionTotal(e,t.qOfUsers),this.consumptionList(t.maxValues),this.createMessages(t.messages)}};console.log("------------- main -------------");var userSetting={add:function(e,t){if("device"===e&&(this.devices[t]+=1,void 0===this.numOfDisp?this.numOfDisp=1:this.numOfDisp<10&&(this.numOfDisp+=1)),"profile"===e){var i=this.userTypes[t][0];this.userTypes[t][1]+=1,void 0===this[i]?this[i]=1:this[i]<7&&(this[i]+=1)}},remove:function(e,t){if("device"===e)return this.devices[t]>0&&(this.devices[t]-=1),void(this.numOfDisp>0&&this.devices[t]<10&&(this.numOfDisp-=1));if("profile"===e){var i=this.userTypes[t][0];return this.userTypes[t][1]>0&&(this.userTypes[t][1]-=1),void(this[i]>0&&this.userTypes[t][1]<7&&(this[i]-=1))}},defineProfile:function(e,t){var i=["basic","medium","high"];if("add"===e&&void 0===this.profile)return void(this.profile=i[t]);for(var s=0;s<i.length;s++)if(this.profile===i[s]){if("add"===e&&t>s)return void(this.profile=i[t]);if("remove"!==e||s!==t)return this.profile;if(!(t>0))return void(this.profile=void 0);for(var a=s;a>0;a--){if(this.userTypes[a-1][1]>0)return void(this.profile=i[a-1]);if(1===a)return void(this.profile=void 0)}}},reset:function(){for(var e in this)"function"!=typeof this[e]&&(this[e]=void 0);this.devices=[0,0,0,0],this.userTypes=[["basicUser",0],["mediumUser",0],["highUser",0]],$(".profile, .devices").parent().find(".total").text(0)}};userSetting.reset(),$(".devices").on("click",function(){var e=$(this).data("disp");$(this).hasClass("more")&&userSetting.add("device",e),$(this).hasClass("less")&&userSetting.remove("device",e),$(this).parent().find(".total").text(userSetting.devices[e]),void 0!==userSetting.profile&&(familyData.createData(userSetting,dataset),updateGraph(familyData)),$(".step.second").removeClass("disable"),event.preventDefault()}),$(".profile").on("click",function(){var e=$(this).data("user"),t=userSetting.userTypes[e][1];$(this).hasClass("more")&&(0===t&&userSetting.defineProfile("add",e),userSetting.add("profile",e)),$(this).hasClass("less")&&(1===t&&userSetting.defineProfile("remove",e),userSetting.remove("profile",e)),$(this).parent().find(".total").text(userSetting.userTypes[e][1]),void 0===userSetting.profile?($(".box-bar .result-list").text(0),updateGraph()):(familyData.createData(userSetting,dataset),updateGraph(familyData),$(".box-bar").each(function(e){$(this).find(".result-list").text(familyData.list.q[e])})),event.preventDefault()}),$(".box-bar").hover(function(){void 0!==userSetting.profile&&($(this).addClass("active"),updateGraph(familyData,[$(this).data("type"),$(this).data("index")]))},function(){void 0!==userSetting.profile&&($(this).removeClass("active"),updateGraph(familyData))}),$("#reset .reset-graph").on("click",function(){updateGraph(),userSetting.reset(),$(".box-bar .result-list").text(0),event.preventDefault()}),$(function(){$(".step.second .selectorBox:first").css("margin-left","11.5%"),$(".step.second").addClass("disable")});var width=425,height=425,radius=Math.min(width,height)/2,innerRadius=radius-30,fontSize=85,fontFill="#007b82",colors=["#005b7f","#007dac","#00a99d","#6cc17b","#a7003d","#6f2c91","#4b0049"],svg=d3.select("#svg").append("svg").attr("width",width).attr("height",height).append("svg:g").attr("transform","translate("+radius+","+radius+")"),innerGroup=svg.append("svg:g").attr("class","inner-radius"),subGroupA=svg.append("svg:g").attr("class","numbers").attr("transform","translate(0,"+-(height/4)+")"),subGroupB=svg.append("svg:g").attr("class","labels").attr("transform","translate(0,"+-(height/4)+")");updateGraph();